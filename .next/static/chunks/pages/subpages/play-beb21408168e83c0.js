(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[939],{923:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/subpages/play",function(){return r(799)}])},9443:function(e,t,r){"use strict";r.r(t);var s=r(5893);r(7294),t.default=e=>{let{onClick:t,top:r,left:l,size:n}=e;return(0,s.jsx)("img",{src:"/diamond.png",alt:"falling tile",style:{top:"".concat(r,"px"),left:"".concat(l,"%"),width:"".concat(n,"px"),height:"".concat(n,"px"),position:"absolute",transform:"translateX(-50%)",cursor:"pointer"},onClick:t,onTouchStart:e=>{e.preventDefault(),t()}})}},799:function(e,t,r){"use strict";r.r(t);var s=r(5893),l=r(7294),n=r(9443),a=r(4298),o=r.n(a),i=r(1664),c=r.n(i);t.default=()=>{let[e,t]=(0,l.useState)([]),[r,a]=(0,l.useState)(0),[i,d]=(0,l.useState)(30),[u,f]=(0,l.useState)(!1),[p,h]=(0,l.useState)("Anon"),m=(0,l.useRef)(null),x=(0,l.useRef)(r);(0,l.useEffect)(()=>{var e,t,r;let s=null===(r=window.Telegram)||void 0===r?void 0:null===(t=r.WebApp)||void 0===t?void 0:null===(e=t.initDataUnsafe)||void 0===e?void 0:e.user;if(s&&h(s.username||"bernardblockchain"),u)return;let l=setInterval(()=>{b(),v()},100),n=setInterval(()=>{d(e=>e<=1?(clearInterval(l),clearInterval(n),f(!0),0):e-1)},1e3);return()=>{clearInterval(l),clearInterval(n)}},[u]),(0,l.useEffect)(()=>{x.current=r},[r]),(0,l.useEffect)(()=>{u&&j(x.current)},[u]);let b=()=>{let e=Array.from({length:Math.floor(1*Math.random())+1},()=>({id:Math.random(),top:0,left:100*Math.random(),size:30*Math.random()+20}));t(t=>[...e,...t])},v=()=>{let e=m.current.clientHeight;t(t=>t.map(e=>({...e,top:e.top+15})).filter(t=>t.top<e))},g=e=>{t(t=>t.filter(t=>t.id!==e)),a(e=>e+1)},j=async e=>{try{let t=await fetch("https://bern-db.onrender.com/api/ton-diamond/update-score",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:p,score:e})});console.log("username",p),console.log("score:",e);let r=await t.json();t.ok?console.log("Score updated successfully:",r):console.error("Failed to update user score:",r.message)}catch(e){console.error("Failed to update user score:",e)}},w=()=>{t([]),a(0),d(30),f(!1)};return(0,s.jsxs)("div",{id:"game-container",ref:m,className:"relative w-[100vw] h-screen overflow-hidden",children:[(0,s.jsx)(o(),{src:"https://telegram.org/js/telegram-web-app.js",strategy:"beforeInteractive"}),(0,s.jsx)("div",{children:p})," ",(0,s.jsxs)("div",{id:"score",className:"absolute text-black top-1 left-2 text-xl",children:["Score: ",r]}),(0,s.jsxs)("div",{id:"timer",className:"absolute text-black top-1 right-2 text-xl",children:["Time Left: ",i,"s"]}),(0,s.jsx)("div",{id:"tiles-container",className:"absolute top-0 w-full h-full",children:e.map(e=>(0,s.jsx)(n.default,{onClick:()=>g(e.id),top:e.top,left:e.left,size:e.size},e.id))}),u&&(0,s.jsx)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-75",children:(0,s.jsxs)("div",{className:"bg-black rounded-md border border-[#1F7DF1] p-4 rounded shadow-lg text-center",children:[(0,s.jsx)("h2",{className:"text-2xl mb-4",children:"Game Over!"}),(0,s.jsxs)("p",{className:"mb-4",children:["Your score is ",r]}),(0,s.jsx)("button",{onClick:w,className:"bg-[#1F7DF1] font-semibold text-white px-4 py-2 rounded",children:"Play Again"}),(0,s.jsx)("div",{children:(0,s.jsx)(c(),{href:"/",children:(0,s.jsx)("button",{onClick:w,className:"bg-[#1F7DF1] font-semibold text-white px-4 py-2 my-2 rounded",children:"Home"})})})]})})]})}}},function(e){e.O(0,[835,888,774,179],function(){return e(e.s=923)}),_N_E=e.O()}]);